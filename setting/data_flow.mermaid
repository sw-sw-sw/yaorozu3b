
flowchart LR
    subgraph Processes["プロセス"]
        direction LR
        Ecosystem["Ecosystem"]
        TensorFlow["TensorFlow Simulation"]
        Box2D["Box2D Simulation"]
        VisualSystem["Visual System"]
        ParameterControlUI["Parameter Control UI"]
    end

    subgraph SharedMemory["共有メモリ"]
        direction TB
        positions["positions (Array)"]
        forces["forces (Array)"]
        agent_ids["agent_ids (Array)"]
        agent_species["agent_species (Array)"]
        current_agent_count["current_agent_count (Value)"]
        tf_time["tf_time (Value)"]
        box2d_time["box2d_time (Value)"]
        simulation_params["シミュレーションパラメータ (各Value)"]
    end

    subgraph Queues["キュー"]
        direction TB
        rendering_queue["rendering_queue"]
        eco_to_visual_creatures["eco_to_visual_creatures"]
        eco_to_box2d_creatures["eco_to_box2d_creatures"]
        ui_to_tensorflow["ui_to_tensorflow"]
    end

    %% Ecosystem connections
    Ecosystem -->|Initialize| positions & agent_ids & agent_species & current_agent_count
    Ecosystem -->|updade| eco_to_visual_creatures & eco_to_box2d_creatures

    %% TensorFlow connections
    TensorFlow -->|updade| forces & tf_time
    TensorFlow -.->|reading| positions & agent_species & simulation_params
    TensorFlow -.->|reading| ui_to_tensorflow

    %% Box2D connections
    Box2D -.->|reading| forces
    Box2D -->|updade| positions & box2d_time
    Box2D -->|updade| rendering_queue

    %% VisualSystem connections
    VisualSystem -.->|reading| rendering_queue & eco_to_visual_creatures

    %% ParameterControlUI connections
    ParameterControlUI -->|updade| simulation_params
    ParameterControlUI -->|updade| ui_to_tensorflow

    %% Layout adjustments
    Processes ~~~ SharedMemory
    SharedMemory ~~~ Queues
